function log_users(){page=$("#logs_pagination").attr("page");page_size=$("#log_page_size").val();mydata={page:page,page_size:page_size};$.ajax({url:filepath+"enable_disable/get_log/",type:"POST",dataType:"html",data:mydata,async:true,success:function(e){json_data=JSON.parse(e);var t=[];if(json_data!=null){var n=json_data.results.length}else{var n=0}var r=json_data.log_data.num_pages;if(n>0){var i="<tr class='log_row'>";i+="<th>Username_user</th>";i+="<th>Username_admin</th>";i+="<th>Email</th>";i+="<th>Date</th>";i+="<th>Action</th>";i+="</tr>";t.push(i);for(var s=0;s<n;s+=1){var o="<tr class='log_row'>";o+="<td class='log_col'>"+json_data.results[s].username_user+"</td>";o+="<td class='log_col'>"+json_data.results[s].username_admin+"</td>";o+="<td class='log_col'>"+json_data.results[s].email+"</td>";o+="<td class='log_col'>"+json_data.results[s].date+"</td>";o+="<td class='log_col'>"+json_data.results[s].action+"</td>";o+="</tr>";t.push(o)}$("#log_table").html(t);if(r>1){generateLogPagination(r)}else{$("#logs_pagination").removeAttr();$("#logs_pagination").html("")}}else{$("#log_table").before("<p>No logs yet</p>")}}})}function generateLogPagination(e){var t=$("#logs_pagination");$(t).attr({pagecount:e});var n=$(t).attr("page")*1;var r="";var i=10;r+="<a href='javascript:void(0)' id='prev_log_page'> < Prev&nbsp;&nbsp;</a>";for(var s=1;s<=e;s+=1){if(n>i/2&&n-i/2>s)continue;if(s>n+i/2&&s>i)continue;if(s===n)r+="<strong>";r+="<a href='javascript:void(0)' page='"+s+"' class='log_page'>&nbsp;"+s+"&nbsp;</a>";if(s===n)r+="</strong>"}r+="<a href='javascript:void(0)' id='next_log_page'> &nbsp;&nbsp;Next > </a>";$(t).html(r);$(".log_page").on("click",function(){$(t).attr({page:$(this).attr("page")});log_users()});if(n>1){$("#prev_log_page").on("click",function(){var e=$(t).attr("page")*1-1;$(t).attr({page:e});log_users()})}if(n!==e){$("#next_log_page").on("click",function(){var e=$(t).attr("page")*1+1;$(t).attr({page:e});log_users()})}}function action_handler(){var e=$(this).attr("class");var t="Activate";var n="Enable";var r="Disable";var i=$(this).attr("username");var s=$(this).attr("email");$this=$(this);thisAction=t;if(e=="Enable_button")thisAction=n;else if(e=="Disable_button")thisAction=r;var o=$(this).attr("student_no");var u="Student Number: ";if($(this).attr("usertype")==="employee"){o=$(this).attr("emp_no");u="Employee Number: "}var a="Are you sure you want to "+thisAction+" this account?\nUsername: "+i+"\n"+u+o+"\nE-mail: "+s;if(confirm(a)){var f=thisAction.toLowerCase();var l=filepath+"enable_disable/"+f+"/"+i;var c=f==t.toLowerCase();if(c)l+="/"+$(this).attr("usertype")+"/"+o;$.ajax({url:l+"/"+s,type:"POST",dataType:"html",async:true,success:function(i){var s=JSON.parse(i);var o=n;var u="Enable_button";if(thisAction==n||thisAction==t)o=r;if(e=="Activate_button"||e=="Enable_button")u="Disable_button";if(s.success){$this.val(o);$this.removeClass(e).addClass(u);alert("Successfully "+thisAction+"d the account");$("#logs_pagination").attr({page:"1"});log_users()}else{if(c){alert("Invalid user! Account automatically deleted");$this.closest("tr").remove()}}}})}}function main(){$("#result_table").on("click",".Activate_button",action_handler);$("#result_table").on("click",".Enable_button",action_handler);$("#result_table").on("click",".Disable_button",action_handler);log_users();$("#log_page_size").change(function(){$("#logs_pagination").attr({page:1});log_users()})}var filepath=icejjfish;$(document).ready(main)