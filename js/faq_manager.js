function updateChanges(){var e=$(this).closest("tr");var t=e.attr("faq_id");var n=nicEditors.findEditor("answer_"+t);n.saveContent();var r=n.getContent();var i={id:e.attr("faq_id"),question:e.find(".question").text(),answer:r};$.post("index.php/faq/edit",i,function(t){t=JSON.parse(t);e.find(".question h5").text(t.question);e.find(".answer").html(t.answer);e.find(".question").attr("contenteditable",false);e.find(".save_faq_button").hide();e.find(".edit_faq_button").show();e.find(".cancel_faq_button").hide();e.removeClass("active");customEditor.removeInstance("answer_"+e.attr("faq_id"));e.find(".answer_editor").hide();e.find(".answer").show();e.find(".question").removeClass("editable")}).fail(function(){alert("There was a problem editing the material.");cancelChanges.call(e.find(".cancel_faq_button")[0])})}function setEditTarget(){$("#add_faq_container").closest("tr").hide();var e=$("#faq_table_container");var t=e.find(".active");if(t.length!=0){cancelChanges.call(t[0])}var n=$(this).closest("tr");n.addClass("active");n.find(".edit_faq_button").hide();var r=n.find(".question").text();var i=n.find(".answer").html();n.find(".prev_question").text(r);n.find(".answer_editor").text(i);n.find(".question").attr("contenteditable",true);n.find(".answer").hide();n.find(".answer_editor").show();n.find(".save_faq_button").show();n.find(".cancel_faq_button").show();customEditor.panelInstance("answer_"+n.attr("faq_id"));n.find(".question").addClass("editable");n.find(".question")[0].focus()}function cancelChanges(){var e=$(this).closest("tr");e.removeClass("active");e.find(".question").text(e.find(".prev_question").text());e.find(".question").attr("contenteditable",false);e.find(".question").removeClass("editable");customEditor.removeInstance("answer_"+e.attr("faq_id"));e.find(".answer_editor").hide();e.find(".answer").show();e.find(".save_faq_button").hide();e.find(".edit_faq_button").show();e.find(".cancel_faq_button").hide()}function deleteFaq(e){e.preventDefault();var t=confirm("Confirm deleting this FAQ");if(t){var n=$(this).closest("tr").attr("faq_id");console.log(n);$.post("index.php/faq/delete",{id:n},function(){$("tr[faq_id='"+n+"']").remove()})}}function showAddForm(e){e.preventDefault();if(!$("#add_faq_container").closest("tr").is(":visible")){var t=$("#faq_table").find(".active");var n=t.closest("tr");cancelChanges.call(n);var r=$("#add_faq_container");r.closest("tr").fadeIn();r.show();customEditor.panelInstance("add_answer");r.find("#add_question")[0].focus()}}function addFAQ(e){e.preventDefault();var t=nicEditors.findEditor("add_answer");t.saveContent();var n=t.getContent();e.preventDefault();var r={question:$(this).find("#add_question").val(),answer:n};var i=this;$.post("index.php/faq/add",r,function(e){e=JSON.parse(e);console.log(e);var n=generateFaqRow(e,true);$("#faq_table").find("tbody tr:first-child").after(n);$(i).closest("div").hide();i.reset();t.setContent("")}).fail(function(){alert("There was a problem adding the material.")})}function cancelAddForm(e){e.preventDefault();$(this).closest("tr").hide();customEditor.removeInstance("add_answer");$(this).closest("form")[0].reset()}var customEditor;$("#faq_table_container").ready(function(){var e=$("#add_faq_container");e.closest("tr").hide();$("#add_faq_button").on("click",showAddForm);$("#add_faq_form").submit(addFAQ);var t=$("#faq_table_container");t.on("click",".edit_faq_button",setEditTarget);t.on("click",".save_faq_button",updateChanges);t.on("click",".cancel_faq_button",function(){cancelChanges.call($(this).closest("tr"))});t.on("click",".delete_faq_button",deleteFaq);$("#add_faq_cancel_button").on("click",cancelAddForm);customEditor=new nicEditor({iconsPath:icejjfish+"js/nicEditorIcons.gif"})})